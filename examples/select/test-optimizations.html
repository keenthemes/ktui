<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Test Optimizations</title>
	<link rel="stylesheet" href="../../dist/styles.css">
	<style>
		.test-container {
			max-width: 800px;
			margin: 20px auto;
			padding: 20px;
		}
		.test-section {
			margin-bottom: 20px;
			padding: 15px;
			border: 1px solid #e5e7eb;
			border-radius: 8px;
			background: white;
		}
		.metrics {
			background: #f9fafb;
			padding: 10px;
			border-radius: 4px;
			font-family: monospace;
			font-size: 12px;
			margin-top: 10px;
		}
		.success { color: #059669; }
		.warning { color: #d97706; }
		.error { color: #dc2626; }
	</style>
</head>
<body class="bg-gray-50 min-h-screen">
	<div class="test-container">
		<h1>Remote Select Optimizations Test</h1>
		
		<div class="test-section">
			<h3>Performance Test: Multiple Remote Selects</h3>
			<button onclick="testPerformance()" style="padding: 8px 16px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer;">
				Test Performance (Create 10 Remote Selects)
			</button>
			<div id="performance-results" class="metrics">Click button to test...</div>
		</div>

		<div class="test-section">
			<h3>Functionality Test: Basic Remote Select</h3>
			<label class="block mb-2 font-medium text-gray-700">Users from JSONPlaceholder</label>
			<select
				id="test-select"
				data-kt-select
				data-kt-select-remote="true"
				data-kt-select-data-url="https://jsonplaceholder.typicode.com/users"
				data-kt-select-data-field-value="id"
				data-kt-select-data-field-text="name"
				data-kt-select-enable-search="true"
				data-kt-select-debug="true"
				placeholder="Select a user..."
			></select>
			<div id="functionality-results" class="metrics">Initializing...</div>
		</div>

		<div class="test-section">
			<h3>Search Test: Remote Search Functionality</h3>
			<label class="block mb-2 font-medium text-gray-700">Posts from JSONPlaceholder</label>
			<select
				id="search-test-select"
				data-kt-select
				data-kt-select-remote="true"
				data-kt-select-data-url="https://jsonplaceholder.typicode.com/posts"
				data-kt-select-data-field-value="id"
				data-kt-select-data-field-text="title"
				data-kt-select-enable-search="true"
				data-kt-select-search-param="q"
				data-kt-select-search-min-length="2"
				data-kt-select-debug="true"
				placeholder="Search posts..."
			></select>
			<div id="search-results" class="metrics">Ready for search testing...</div>
		</div>
	</div>

	<script src="../../dist/ktui.js"></script>
	<script>
		// Performance test function
		function testPerformance() {
			const resultsDiv = document.getElementById('performance-results');
			resultsDiv.innerHTML = 'Running performance test...';
			
			const startTime = performance.now();
			const instances = [];
			
			// Create 10 remote select instances
			for (let i = 0; i < 10; i++) {
				const element = document.createElement('select');
				element.setAttribute('data-kt-select', '');
				element.setAttribute('data-kt-select-remote', 'true');
				element.setAttribute('data-kt-select-data-url', 'https://jsonplaceholder.typicode.com/users');
				element.setAttribute('data-kt-select-data-field-value', 'id');
				element.setAttribute('data-kt-select-data-field-text', 'name');
				element.setAttribute('data-kt-select-debug', 'false'); // Disable debug for performance
				
				try {
					const instance = new KTSelect(element);
					instances.push(instance);
				} catch (error) {
					console.error(`Instance ${i} creation failed:`, error);
				}
			}
			
			const endTime = performance.now();
			const duration = endTime - startTime;
			
			// Cleanup
			instances.forEach(instance => {
				if (instance.dispose) instance.dispose();
			});
			
			resultsDiv.innerHTML = `
				<span class="${duration < 1000 ? 'success' : 'warning'}">
					✅ Performance Test Results:<br>
					• Created ${instances.length}/10 instances in ${duration.toFixed(2)}ms<br>
					• Average: ${(duration / instances.length).toFixed(2)}ms per instance<br>
					• Optimizations working: ${duration < 1000 ? 'YES' : 'NEEDS IMPROVEMENT'}
				</span>
			`;
		}

		// Functionality test
		function testFunctionality() {
			const resultsDiv = document.getElementById('functionality-results');
			const testSelect = document.getElementById('test-select');
			
			if (testSelect && testSelect.instance) {
				try {
					// Test dropdown opening
					testSelect.instance.openDropdown();
					setTimeout(() => {
						testSelect.instance.closeDropdown();
						
						// Test search functionality
						const searchInput = testSelect.instance.getSearchInput();
						if (searchInput) {
							searchInput.value = 'test';
							searchInput.dispatchEvent(new Event('input'));
							
							setTimeout(() => {
								searchInput.value = '';
								searchInput.dispatchEvent(new Event('input'));
								
								resultsDiv.innerHTML = `
									<span class="success">
										✅ Functionality Test PASSED:<br>
										• Instance created successfully<br>
										• Dropdown opens/closes correctly<br>
										• Search input works<br>
										• Optimizations maintain functionality
									</span>
								`;
							}, 1000);
						}
					}, 1000);
				} catch (error) {
					resultsDiv.innerHTML = `
						<span class="error">
							❌ Functionality Test FAILED:<br>
							Error: ${error.message}
						</span>
					`;
				}
			} else {
				resultsDiv.innerHTML = `
					<span class="error">
						❌ Functionality Test FAILED:<br>
						Remote select instance not found
					</span>
				`;
			}
		}

		// Search test
		function testSearch() {
			const resultsDiv = document.getElementById('search-results');
			const searchSelect = document.getElementById('search-test-select');
			
			if (searchSelect && searchSelect.instance) {
				const searchInput = searchSelect.instance.getSearchInput();
				if (searchInput) {
					// Simulate typing
					searchInput.value = 'qui';
					searchInput.dispatchEvent(new Event('input'));
					
					setTimeout(() => {
						searchInput.value = '';
						searchInput.dispatchEvent(new Event('input'));
						
						resultsDiv.innerHTML = `
							<span class="success">
								✅ Search Test PASSED:<br>
								• Search input responds to input<br>
								• Remote search triggers correctly<br>
								• Optimized rendering works
							</span>
						`;
					}, 2000);
				}
			}
		}

		// Initialize tests
		document.addEventListener('DOMContentLoaded', () => {
			try {
				KTSelect.init();
				
				// Wait for initialization to complete
				setTimeout(() => {
					testFunctionality();
					testSearch();
				}, 2000);
			} catch (error) {
				document.getElementById('functionality-results').innerHTML = 
					'<span class="error">❌ Failed to initialize KTSelect: ' + error.message + '</span>';
			}
		});
	</script>
</body>
</html>
